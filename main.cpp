#include "all.h"
#include <map>
#include <iomanip>

int main(int argc, char* argv[]) {
    if (argc == 1) {
        std::cout << "need db name\n";
        return 0;
    }
    std::string log = "log_" + std::string(argv[1]) + ".txt";
    std::string fn = "dbs/" + std::string(argv[1]) + ".db";

    if (!std::filesystem::exists(fn)) {
        std::cerr << "you would die\n";
        return 0;
    }

    freopen(log.c_str(), "w", stdout);

    DB db(fn);

    // Payload p;
    // ReturnCodes rc = db.find(2, 5, &p);

    // if (rc == ReturnCodes::CellFound) {
    //     std::string map = p.get_text_column(2);
    //     std::cout << "map.json: " << map << "\n\n\n";
    //     std::cout << "found cell\n";
    // }

    db.parse_schema();

    std::string sql = "SELECT * FROM maps WHERE (id=5 OR id >= 10) and id < 25";

    db.parse_select_sql(sql);

    std::string sql_ = "INSERT INTO maps VALUES(45, '{\"width\": 607, \"height\": 299, \"points\": [[512, 230], [520, 293], [25, 200], [484, 229], [423, 42], [550, 182], [374, 237], [275, 79], [495, 255], [444, 151], [570, 199], [257, 175], [41, 296], [12, 258], [179, 198], [341, 107], [279, 224], [420, 201], [248, 74], [118, 90], [281, 220], [596, 162], [459, 220], [255, 139], [137, 270], [264, 29], [170, 114], [3, 92], [562, 115], [414, 164], [77, 42], [285, 10], [227, 218], [568, 56], [55, 215], [386, 4], [353, 252], [321, 160], [249, 49], [384, 161], [495, 209], [442, 54], [231, 210], [212, 262], [437, 54], [101, 183], [173, 52], [32, 290], [530, 28], [124, 124], [288, 244], [102, 294], [335, 218], [247, 243], [546, 8], [161, 286], [509, 175], [453, 66], [11, 185], [212, 2], [178, 34], [565, 126], [239, 91], [112, 67], [584, 250], [354, 13], [264, 250], [599, 207], [30, 112], [361, 7], [373, 14], [6, 123], [25, 289], [304, 276], [134, 95], [315, 88], [508, 133], [274, 157], [519, 171], [366, 282], [12, 179], [319, 210], [116, 55], [267, 286], [430, 296], [447, 245], [412, 202], [182, 46], [59, 84], [397, 97], [393, 174], [270, 113], [379, 5], [560, 70]], \"roads\": [[16, 20], [41, 44], [58, 80], [47, 72], [17, 86], [32, 42], [65, 69], [56, 78], [70, 92], [28, 61], [63, 82], [69, 70], [39, 90], [33, 93], [41, 57], [35, 70], [19, 74], [12, 72], [52, 81], [53, 66], [4, 44], [46, 60], [18, 62], [2, 58], [16, 50], [3, 40], [29, 90], [19, 63], [50, 66], [11, 77], [25, 38], [18, 38], [48, 54], [6, 36], [23, 77], [68, 71], [3, 22], [0, 40], [7, 18], [22, 85], [3, 8], [25, 31], [24, 55], [23, 91], [10, 67], [49, 74], [27, 71], [32, 53], [15, 75], [36, 79], [5, 78], [2, 34], [13, 72], [86, 90], [7, 91], [50, 73], [66, 83], [40, 56], [36, 52], [20, 81], [76, 78], [43, 53], [68, 88], [26, 74], [7, 75], [30, 82], [24, 51], [17, 22], [11, 42], [28, 93], [21, 67], [1, 8], [64, 67], [30, 88], [59, 60], [37, 77], [33, 48], [21, 61], [5, 21], [6, 86], [14, 32], [4, 35], [59, 87], [84, 85], [9, 17], [34, 45], [71, 80], [43, 55], [15, 89], [46, 82], [25, 59], [44, 89], [2, 13]], \"bushes\": [[523, 141], [565, 56], [287, 215], [224, 284], [567, 297], [517, 26], [321, 69], [265, 268], [40, 188], [195, 56], [221, 100], [273, 49], [27, 19], [166, 287], [366, 103], [427, 139], [331, 232], [518, 129], [217, 228], [237, 256], [344, 227], [320, 1], [393, 15], [320, 225], [435, 226], [237, 244], [24, 108], [288, 250], [600, 3], [64, 284], [194, 97], [211, 17], [325, 28], [328, 104], [67, 18], [337, 213], [501, 110], [445, 203], [108, 191], [544, 279], [421, 46], [357, 211], [272, 9], [338, 81], [586, 28], [551, 8], [89, 277], [486, 202], [494, 55], [507, 17], [197, 243], [544, 220], [583, 184], [256, 1], [547, 143], [216, 165], [382, 178], [577, 57], [1, 111], [37, 76], [598, 82], [144, 267], [190, 11], [350, 1], [514, 96]], \"trees\": [[442, 160], [541, 30], [183, 2], [115, 141], [124, 124], [495, 76], [480, 9], [507, 225], [486, 155], [542, 299], [23, 269], [535, 223], [451, 14], [386, 60], [173, 235], [471, 2], [147, 273], [3, 27], [511, 120], [216, 111], [342, 266], [296, 96], [124, 228], [407, 203], [357, 78], [512, 190], [431, 78], [264, 248], [595, 277], [66, 231], [392, 90], [266, 207], [19, 177], [394, 291], [3, 28], [297, 24], [549, 281], [335, 2], [466, 289], [301, 206], [340, 63], [400, 44], [432, 150], [420, 181], [310, 128], [85, 261], [221, 202], [257, 61], [497, 90], [487, 210], [135, 178], [236, 182], [225, 157], [242, 62], [42, 221], [273, 46], [507, 202]], \"sheeps\": [[188, 20], [598, 240], [505, 93], [24, 275], [60, 142], [380, 134], [170, 21], [205, 243], [45, 289], [392, 55], [336, 209], [591, 212], [458, 251], [424, 36]], \"fields\": [[[321, 160], [274, 157], [319, 210]], [[274, 157], [281, 220], [319, 210]], [[274, 157], [257, 175], [281, 220]], [[231, 210], [279, 224], [281, 220]], [[281, 220], [288, 244], [319, 210]], [[288, 244], [335, 218], [319, 210]], [[319, 210], [335, 218], [321, 160]], [[279, 224], [288, 244], [281, 220]], [[270, 113], [255, 139], [274, 157]], [[274, 157], [255, 139], [257, 175]], [[179, 198], [231, 210], [257, 175]], [[257, 175], [231, 210], [281, 220]], [[279, 224], [264, 250], [288, 244]], [[247, 243], [264, 250], [279, 224]], [[321, 160], [270, 113], [274, 157]], [[231, 210], [247, 243], [279, 224]], [[179, 198], [227, 218], [231, 210]], [[231, 210], [227, 218], [247, 243]], [[288, 244], [353, 252], [335, 218]], [[384, 161], [341, 107], [321, 160]], [[304, 276], [353, 252], [288, 244]], [[384, 161], [321, 160], [335, 218]], [[321, 160], [315, 88], [270, 113]], [[393, 174], [384, 161], [335, 218]], [[267, 286], [288, 244], [264, 250]], [[267, 286], [304, 276], [288, 244]], [[353, 252], [374, 237], [335, 218]], [[374, 237], [393, 174], [335, 218]], [[341, 107], [315, 88], [321, 160]], [[212, 262], [267, 286], [247, 243]], [[247, 243], [267, 286], [264, 250]], [[315, 88], [275, 79], [270, 113]], [[270, 113], [239, 91], [255, 139]], [[255, 139], [179, 198], [257, 175]], [[275, 79], [239, 91], [270, 113]], [[227, 218], [212, 262], [247, 243]], [[179, 198], [212, 262], [227, 218]], [[374, 237], [412, 202], [393, 174]], [[170, 114], [179, 198], [255, 139]], [[412, 202], [414, 164], [393, 174]], [[393, 174], [414, 164], [384, 161]], [[384, 161], [397, 97], [341, 107]], [[275, 79], [248, 74], [239, 91]], [[239, 91], [170, 114], [255, 139]], [[353, 252], [366, 282], [374, 237]], [[447, 245], [420, 201], [412, 202]], [[304, 276], [366, 282], [353, 252]], [[267, 286], [366, 282], [304, 276]], [[447, 245], [412, 202], [374, 237]], [[412, 202], [420, 201], [414, 164]], [[414, 164], [397, 97], [384, 161]], [[341, 107], [354, 13], [315, 88]], [[264, 29], [249, 49], [275, 79]], [[275, 79], [249, 49], [248, 74]], [[264, 29], [275, 79], [285, 10]], [[248, 74], [182, 46], [239, 91]], [[173, 52], [170, 114], [239, 91]], [[420, 201], [444, 151], [414, 164]], [[414, 164], [444, 151], [397, 97]], [[285, 10], [275, 79], [315, 88]], [[249, 49], [182, 46], [248, 74]], [[430, 296], [447, 245], [374, 237]], [[420, 201], [459, 220], [444, 151]], [[447, 245], [459, 220], [420, 201]], [[212, 262], [161, 286], [267, 286]], [[137, 270], [161, 286], [212, 262]], [[137, 270], [212, 262], [179, 198]], [[354, 13], [285, 10], [315, 88]], [[178, 34], [182, 46], [212, 2]], [[267, 286], [430, 296], [366, 282]], [[366, 282], [430, 296], [374, 237]], [[447, 245], [484, 229], [459, 220]], [[102, 294], [430, 296], [267, 286]], [[182, 46], [249, 49], [212, 2]], [[182, 46], [173, 52], [239, 91]], [[101, 183], [137, 270], [179, 198]], [[124, 124], [179, 198], [170, 114]], [[373, 14], [341, 107], [397, 97]], [[373, 14], [354, 13], [341, 107]], [[134, 95], [124, 124], [170, 114]], [[173, 52], [134, 95], [170, 114]], [[423, 42], [373, 14], [397, 97]], [[373, 14], [361, 7], [354, 13]], [[354, 13], [361, 7], [285, 10]], [[437, 54], [423, 42], [397, 97]], [[373, 14], [379, 5], [361, 7]], [[437, 54], [453, 66], [442, 54]], [[182, 46], [178, 34], [173, 52]], [[112, 67], [118, 90], [134, 95]], [[212, 2], [249, 49], [264, 29]], [[437, 54], [397, 97], [453, 66]], [[495, 255], [484, 229], [447, 245]], [[459, 220], [495, 209], [444, 151]], [[30, 112], [101, 183], [124, 124]], [[124, 124], [101, 183], [179, 198]], [[453, 66], [397, 97], [444, 151]], [[437, 54], [442, 54], [423, 42]], [[508, 133], [453, 66], [444, 151]], [[386, 4], [373, 14], [423, 42]], [[386, 4], [379, 5], [373, 14]], [[361, 7], [212, 2], [285, 10]], [[285, 10], [212, 2], [264, 29]], [[386, 4], [212, 2], [361, 7]], [[484, 229], [495, 209], [459, 220]], [[112, 67], [134, 95], [116, 55]], [[134, 95], [118, 90], [124, 124]], [[134, 95], [173, 52], [116, 55]], [[530, 28], [386, 4], [423, 42]], [[379, 5], [386, 4], [361, 7]], [[430, 296], [495, 255], [447, 245]], [[484, 229], [512, 230], [495, 209]], [[519, 171], [509, 175], [495, 209]], [[495, 209], [509, 175], [444, 151]], [[116, 55], [173, 52], [178, 34]], [[25, 200], [55, 215], [101, 183]], [[509, 175], [508, 133], [444, 151]], [[495, 255], [512, 230], [484, 229]], [[509, 175], [519, 171], [508, 133]], [[77, 42], [116, 55], [178, 34]], [[55, 215], [102, 294], [137, 270]], [[137, 270], [102, 294], [161, 286]], [[161, 286], [102, 294], [267, 286]], [[512, 230], [519, 171], [495, 209]], [[101, 183], [55, 215], [137, 270]], [[59, 84], [124, 124], [118, 90]], [[59, 84], [118, 90], [112, 67]], [[495, 255], [520, 293], [512, 230]], [[512, 230], [550, 182], [519, 171]], [[430, 296], [520, 293], [495, 255]], [[570, 199], [550, 182], [512, 230]], [[565, 126], [562, 115], [508, 133]], [[560, 70], [530, 28], [453, 66]], [[77, 42], [112, 67], [116, 55]], [[77, 42], [59, 84], [112, 67]], [[212, 2], [77, 42], [178, 34]], [[12, 179], [25, 200], [101, 183]], [[55, 215], [41, 296], [102, 294]], [[584, 250], [570, 199], [512, 230]], [[565, 126], [508, 133], [519, 171]], [[565, 126], [519, 171], [550, 182]], [[453, 66], [530, 28], [442, 54]], [[442, 54], [530, 28], [423, 42]], [[596, 162], [565, 126], [550, 182]], [[6, 123], [30, 112], [3, 92]], [[59, 84], [30, 112], [124, 124]], [[32, 290], [41, 296], [55, 215]], [[102, 294], [41, 296], [430, 296]], [[560, 70], [453, 66], [508, 133]], [[30, 112], [12, 179], [101, 183]], [[25, 289], [32, 290], [12, 258]], [[32, 290], [55, 215], [12, 258]], [[12, 179], [11, 185], [25, 200]], [[568, 56], [560, 70], [562, 115]], [[562, 115], [560, 70], [508, 133]], [[12, 258], [55, 215], [25, 200]], [[32, 290], [25, 289], [41, 296]], [[11, 185], [12, 258], [25, 200]], [[520, 293], [584, 250], [512, 230]], [[570, 199], [596, 162], [550, 182]], [[596, 162], [568, 56], [562, 115]], [[30, 112], [6, 123], [12, 179]], [[12, 179], [6, 123], [11, 185]], [[11, 185], [6, 123], [12, 258]], [[3, 92], [30, 112], [59, 84]], [[596, 162], [562, 115], [565, 126]], [[560, 70], [568, 56], [530, 28]], [[599, 207], [596, 162], [570, 199]], [[584, 250], [599, 207], [570, 199]], [[568, 56], [546, 8], [530, 28]], [[530, 28], [546, 8], [386, 4]], [[77, 42], [3, 92], [59, 84]], [[6, 123], [3, 92], [12, 258]]]}')";

    db.parse_insert_sql(sql_);

    return 0;
}
